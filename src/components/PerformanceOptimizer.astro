---
// Performance optimization component to reduce render delays
---

<script is:inline>
  // Optimize rendering performance
  (function() {
    // Reduce layout thrashing
    const optimizeRendering = () => {
      // Use requestAnimationFrame for smooth animations
      if ('requestIdleCallback' in window) {
        requestIdleCallback(() => {
          // Defer non-critical operations
          document.body.classList.add('loaded');
        });
      } else {
        setTimeout(() => {
          document.body.classList.add('loaded');
        }, 100);
      }
    };

    // Optimize font loading
    const optimizeFonts = () => {
      if ('fonts' in document) {
        document.fonts.ready.then(() => {
          document.body.classList.add('fonts-loaded');
        });
      }
    };

    // Reduce CLS (Cumulative Layout Shift)
    const reduceCLS = () => {
      // Reserve space for images
      const images = document.querySelectorAll('img[width][height]');
      images.forEach(img => {
        if (!img.style.aspectRatio && img.width && img.height) {
          img.style.aspectRatio = `${img.width} / ${img.height}`;
        }
      });
    };

    // Initialize optimizations
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        optimizeRendering();
        optimizeFonts();
        reduceCLS();
      });
    } else {
      optimizeRendering();
      optimizeFonts();
      reduceCLS();
    }

    // Optimize scroll performance
    let ticking = false;
    const optimizeScroll = () => {
      if (!ticking) {
        requestAnimationFrame(() => {
          // Scroll optimizations here
          ticking = false;
        });
        ticking = true;
      }
    };

    window.addEventListener('scroll', optimizeScroll, { passive: true });
  })();
</script>

<style is:inline>
  /* Prevent FOUC and optimize rendering */
  body:not(.loaded) {
    opacity: 0.98; /* Slight opacity to prevent flash */
  }

  body.loaded {
    opacity: 1;
    transition: opacity 0.2s ease-in-out;
  }

  /* Optimize font rendering */
  body:not(.fonts-loaded) {
    font-display: swap;
  }

  /* Reduce layout shift for images */
  img {
    height: auto;
    max-width: 100%;
  }

  img[width][height] {
    height: auto;
  }
</style>
